package ui;import chess.ChessBoard;import chess.ChessGame;import chess.ChessPosition;import com.google.gson.Gson;import model.GameData;import websocket.messages.*;import java.util.ArrayList;import java.util.Arrays;import java.util.List;import static ui.EscapeSequences.*;public class MessageUI {    private volatile GameData game;    private ChessGame.TeamColor color;    private Boolean observer;    private boolean entry;    public MessageUI(ChessGame.TeamColor color, GameData game) {        this.color = color;        this.observer = false;        this.entry = true;        if (this.color == null) {            this.color = ChessGame.TeamColor.WHITE;            this.observer = true;        }        this.game = game;    }    public void call(String message) {        ServerMessage mess = new Gson().fromJson(message, ServerMessage.class);        switch (mess.getServerMessageType()) {            case ERROR -> {error(new Gson().fromJson(message, ErrorMessage.class));}            case LOAD_GAME -> {update(new Gson().fromJson(message, LoadGame.class));}            case NOTIFICATION -> {tell(new Gson().fromJson(message, Notification.class));}            default -> {ignore();}        }    }    private void error(ErrorMessage error) {        System.out.println(Arrays.stream(error.getErrorMessage().split(": ")).toList().getLast());        printPrompt();    }    private void update(LoadGame game) {        if (game.getGame() != null) {            if (entry) {entry = false;}            else if (observer) {System.out.println();}            else if (color.equals(game.getGame().game().getTeamTurn())) {System.out.println();}            this.game = game.getGame();            draw();        }    }    private void tell(Notification note) {        System.out.print(ERASE_LINE);        System.out.flush();        String prepNote = note.getNotification();        if (note.getType().equals(Notification.nType.MOVE)) {            String[] moveData = prepNote.split(":");            String[] coordinates = moveData[1].split("\\), ");            String[] start = coordinates[0].split(",");            start[0] = start[0].substring(3);            String[] end = coordinates[1].split(",");            end[0] = end[0].substring(1);            String promotion = coordinates[2].replace(")", "");            if (!promotion.equals("null")) {promotion = ", promoted pawn to " + promotion;}            else {promotion = "";}            String sCol = "abcdefgh".substring(Integer.parseInt(start[1])-1, Integer.parseInt(start[1]));            String eCol = "abcdefgh".substring(Integer.parseInt(end[1])-1, Integer.parseInt(end[1]));            prepNote = moveData[0] + " moved " + sCol + start[0] + " to " + eCol + end[0] + promotion;        }        System.out.print(prepNote);        printPrompt();    }    private void ignore() {}    public void draw() {        printGame(game);        if (game.game().getTeamTurn().equals(ChessGame.TeamColor.FINISHED)) {System.out.println("Game is finished");}        printPrompt();    }    public void highlightDraw(ChessPosition pos) {        var validMoves = game.game().validMoves(pos);        System.out.println(pos);        System.out.println(validMoves);    }    public GameData getCurrentGame() {        return game;    }    private void printPrompt() {        System.out.print("\n" + RESET_TEXT_COLOR + "message ui [LOGGED_IN] >>> " + SET_TEXT_COLOR_BLUE);    }    private void printGame(GameData game) {        var builder = new StringBuilder();        ChessBoard board = game.game().getBoard();        String boarderColor = SET_BG_COLOR_LIGHT_GREY + SET_TEXT_COLOR_BLUE;        List<String> boardView = new ArrayList<>(Arrays.stream(board.toString().split("\\|")).toList());        String backgroundColor1;        String backgroundColor2;        String horizontal;        List<String> vertical;        builder.append("\n");        if (color.equals(ChessGame.TeamColor.BLACK)) {            horizontal = boarderColor + "    h  g  f  e  d  c  b  a    " + RESET_BG_COLOR;            vertical = new ArrayList<>(Arrays.stream("| 8 | 7 | 6 | 5 | 4 | 3 | 2 | 1 ".split("\\|")).toList());            boardView = boardView.reversed();            backgroundColor1 = SET_BG_COLOR_WHITE;            backgroundColor2 = SET_BG_COLOR_BLACK;        } else {            horizontal = boarderColor + "    a  b  c  d  e  f  g  h    " + RESET_BG_COLOR;            vertical = new ArrayList<>(Arrays.stream("| 1 | 2 | 3 | 4 | 5 | 6 | 7 | 8 ".split("\\|")).toList());            backgroundColor1 = SET_BG_COLOR_BLACK;            backgroundColor2 = SET_BG_COLOR_WHITE;        }        boardView.add("\n");        builder.append(horizontal);        builder.append("\n");        builder.append(boarderColor);        builder.append(vertical.getLast());        for (String part : boardView) { //This iterates through the board            if (part.equals("\n")) {                builder.append(boarderColor);                builder.append(vertical.removeLast());                builder.append(RESET_BG_COLOR);                builder.append(part); //This is where it actually adds the piece                builder.append(boarderColor);                builder.append(vertical.getLast());            }            builder.append(backgroundColor1);            String tempBackground = backgroundColor2;            backgroundColor2 = backgroundColor1;            backgroundColor1 = tempBackground;            builder.append(translatePiece(part));        }        builder.append(SET_TEXT_COLOR_BLUE);        builder.append(RESET_BG_COLOR);        builder.append(horizontal);        builder.append(RESET_BG_COLOR);        builder.append("\n");        System.out.print(builder);    }    private String translatePiece(String piece) {        return switch (piece) {            case "R" -> SET_TEXT_COLOR_MAGENTA + WHITE_ROOK;            case "N" -> SET_TEXT_COLOR_MAGENTA + WHITE_KNIGHT;            case "B" -> SET_TEXT_COLOR_MAGENTA + WHITE_BISHOP;            case "Q" -> SET_TEXT_COLOR_MAGENTA + WHITE_QUEEN;            case "K" -> SET_TEXT_COLOR_MAGENTA + WHITE_KING;            case "P" -> SET_TEXT_COLOR_MAGENTA + WHITE_PAWN;            case "r" -> SET_TEXT_COLOR_LIGHT_GREY + BLACK_ROOK;            case "n" -> SET_TEXT_COLOR_LIGHT_GREY + BLACK_KNIGHT;            case "b" -> SET_TEXT_COLOR_LIGHT_GREY + BLACK_BISHOP;            case "q" -> SET_TEXT_COLOR_LIGHT_GREY + BLACK_QUEEN;            case "k" -> SET_TEXT_COLOR_LIGHT_GREY + BLACK_KING;            case "p" -> SET_TEXT_COLOR_LIGHT_GREY + BLACK_PAWN;            case " " -> EMPTY;            case "\n" -> "";            default -> piece;        };    }}